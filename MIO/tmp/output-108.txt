MIOA.PRN PAGE 5
3251 C24E32 NZ CRIWL
3254 210036 LXI B,BUFR ;SET PARAMATERS
3257 1£00 MVI 2,0 7256 BYTES +
3289 3636 . MVI A,3FE
3253 DIFF OUT SSPT :GIVE LIGHTS AN INITIAL VSLUE
325D CD9E32 CALL WRIT ;00 THE WRITE
3260 AF CRIW2: XRA A ;ALL DONE Looe
3261 2F CMA, ;fOR PROPER LIGHTS
3262 DIFF "UT ssPT .
3264 C36032 SMP CRIW2
;CRI READ TEST READ A BLOCK OF 256 BYTES.
? CHECK THAT EAC# BYTE CONTAINS ITS ADDRESS
: WITHIN THE BLOCK. CRC ERROR IS ALSO CETECTED SY
? > READ BANDLER. -
3267 310036 CRIRTs LXI S2,STACK
326A 210036 LXI H,BUFR ;SET PARAMATERS
3260 1£00 MVI -E,O 7256 SYTES
326f 3E3F MVI A, 3FS sINITIAL VALUE FOR LIGHTS
3271 O3FF out ssPT
3273 ¢00133 CALL READ ;READ THE BLOCK
3276 CA7E32 JZ CRIRL 3JUMP IF NO CRC ERROR
3279 3EFF MVI A,OPPE ;ELSE, DISPLAY IT oan
3278 CD8E31L CALL DISP
327£ 1200 CRIRL: MI E,0 7DO A BYTE SY BYTE COMPARE
3280 210036 LXI H,BUFR
3283 75 CRIR3: MOV A,M
3234 8B CMP OE ;COMPARE A BYTE
. 3285 Ca9532 JZ CRIRZ
3288 3EFE MVI A,OFEd ;DISPLAY THE ERROR
328A CD8E31 CALL DISP
328D 7a MOV A,E 7CORRECT VALUE -
328E CD8E31 CALL DISP
3291 7B MOV A.M ACTUAL VALOE
3292 CDBE31 CALL DISP
3295 23 CRIR2: INX H
3296 IC INR & ;LOOP COUNT
3297 C28332 JNZ CRIR3
325A C36032 IMP CRIW2 ;IP ALL DONE
;GENERAL HANDLERS FOR TARBELL OR PYTE/LANCASTER ON
7CRI. USE 1-255-8YTE SLOCK AND STANDARD CRC ROUTINE
7GR ERROR CHECKING.
3290 00 TYPF: 9B 0 7SET 0 FOR TARBELL, NONZERO FOR 8YTE/LANCASTER
;WRITE ROOTINE ~ THE FOLLOWING PARAMATERS ARE EXPECTED ON ENTRY
z BL - CONTAIN THE MEMORY LOCATION FOR THE 8LCCK
3 & - CONTAINS THE BLOCX SIZE, 1-256. (0=256)
3298 3610 WRIT:  MVI A,108
32A0 D343 OUT CNT
32A2 D340 OUT CRI ;RESET BYTE COUNTS?
32A4 3E3C MVI a,03Ca ;START BYTE
32A6 CDCB32 CALL WRBYT =, . ;OUTPUT IT
32A9 3EE6 MVI A,0E6a 7SYNC BYTE
32AB CDCB32 CALL WREYT ;WRITE A BYTE WHEN READY
32AE OLFFFE LXI 3, 0PFFFH pINITIALIZE CRC VALUE
3281 7e WRITL: MOV A,M }GET A ‘BYTE
3282 Co8r33 CALL CRC yADD TO CRC
3235 7E MOV A, ;GET THE BYTE AGAIN
3286 CDCB32 CALL WREYT ;WRITE IT WHEN READY
3239 23 INX H
